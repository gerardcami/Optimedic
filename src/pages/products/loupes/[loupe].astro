---
import Layout from "../../../layouts/Layout.astro";
import { loupesData } from "../../../services/loupes-data";

// Esta función genera las rutas estáticas para cada producto
export async function getStaticPaths() {
  // Retorna las rutas que Astro debe generar estáticamente a partir de los slugs extraidos
  return loupesData.flatMap((loupeType) =>
    loupeType.products.map((product) => ({
      params: { loupe: product.slug },
    }))
  );
}

// Accede al parámetro de la ruta
const { loupe } = Astro.params;

// Encontrar el producto basado en el slug
const product = loupesData
  .flatMap((loupeType) => loupeType.products)
  .find((product) => product.slug === loupe);

if (!product) {
  throw new Error(`Product not found for slug: ${loupe}`);
}
---

<Layout title={product.name}>
  <section>
    <!-- Title -->
    <article
      class="text-black mt-[60px] lg:mt-[64px] flex items-center justify-center"
    >
      <div>
        <h1>{product.name}</h1>
        <p>{product.description}</p>
      </div>
      <img class="w-1/2" src={product.cover_image} alt={product.name} />
    </article>
    <!-- Specs -->
    <article>
      <h2>Especificaciones</h2>
      <div>
        <p>
          Todos los sistemas ópticos emplean lentes de vidrio e incorporan
          revestimientos antirrayado y antirreflejos.
        </p>
        <p>
          La distancia de trabajo y el ángulo de declinación se adaptan a cada
          usuario.
        </p>
      </div>
      {
        product.specs ? (
          <div>
            {product.specs.map((spec) => (
              <div>
                <div>
                  <h3>Potencia de aumento</h3>
                  <p>{spec.magnification_power}</p>
                </div>
                <div>
                  <h3>Peso</h3>
                  <p>{spec.weight}</p>
                </div>
                <div>
                  <h3>Ancho de campo</h3>
                  <p>{spec.field_width}</p>
                </div>
                <div>
                  <h3>Profundidad de campo</h3>
                  <p>{spec.field_depth}</p>
                </div>
              </div>
            ))}
          </div>
        ) : (
          <p>No hay especificaciones disponibles para este producto.</p>
        )
      }
    </article>
  </section>
</Layout>
