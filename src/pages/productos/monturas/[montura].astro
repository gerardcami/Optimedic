---
import Layout from "../../../layouts/Layout.astro";
import type { Frames } from "../../../types/frames";
import FrameColors from "../../../components/frameColors";
import { getI18N } from "../../../i18n/";
import FrameSpecs from "../../../components/FrameSpecs.astro";

const { currentLocale = "es" } = Astro;
const i18n = getI18N({ currentLocale });

const framesTexts = i18n.FRAMES.TEXTS;
const framesData = i18n.FRAMES.PRODUCTS;

const { montura } = Astro.params;

const product = framesData
  .flatMap((frameType: Frames) => frameType.products)
  .find((product) => product.slug === montura);


if (!product) {
  throw new Error(`Product not found for slug: ${montura}`);
}

const details = product.details;
const hasLoupeOptions = details.loupe_options;
---

<Layout title={product.name} description="">
  {
    <section
      class="w-[calc(100vw-5px)] px-auto py-[50px] flex items-center justify-evenly shadow-[0_20px_25px_-4px_rgba(7,107,97,0.5)]"
      >
      <article class="lg:w-1/3 flex flex-col gap-5">
          <h1 class="text-5xl">{product.name}</h1>
          <p class="text-lg">{details.detailed_description}</p>
      </article>
      <figure class="w-[400px] flex justify-center items-center">
        <img class="w-full" src={product.card_image} alt={product.name} />
      </figure>
    </section>
    <section class="w-full flex flex-col gap-[100px]">
    <article class="flex gap-[100px] justify-between items-center">
      <div class="flex flex-col gap-5">
        {details.intro_text_2 && <p>{details.intro_text_1}</p>}
        {details.intro_text_2 && <p>{details.intro_text_2}</p>}
        {details.intro_text_3 && <p>{details.intro_text_3}</p>}
      </div>
      <img 
        src={details?.intro_image}
        alt="" 
        class="w-[500px] shadow-2xl"
        style="border-radius: 43% 57% 32% 68% / 61% 52% 48% 39%;" 
      />
    </article>   
    <FrameColors client:visible frame={product.name} colors={details.colors} />     
  </section>
  
  <section class="w-full flex gap-[100px]">
    <FrameSpecs texts={framesTexts} specs={details.specs} />
    <article class="flex flex-col gap-5">
      <h3 class="text-2xl font-bold">{framesTexts.text_loupe_options}</h3>
      <div class="flex flex-col">
        {details.loupe_options ? (
          details.loupe_options.map((option) => (
            <a
              href={`../lupas/${option.slug}`}
              class="hover:underline"
            >
              {option.name}
            </a>
          ))
        ) : (
        <a
              href="../lupas/"
              class="hover:underline"
            >
              {framesTexts.text_all_loupe_options}
            </a>
        )}
      </div>
    </article>
  </section>
  }
</Layout>