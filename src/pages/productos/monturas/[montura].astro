---
import Layout from "../../../layouts/Layout.astro";
import type { Frames, Color } from "../../../types/frames";
import { getI18N } from "../../../i18n/";

const { currentLocale = "es" } = Astro;
const i18n = getI18N({ currentLocale });
const framesData = i18n.FRAMES.PRODUCTS;

const { montura } = Astro.params;

const product = framesData
  .flatMap((frameType: Frames) => frameType.products)
  .find((product) => product.slug === montura);


if (!product) {
  throw new Error(`Product not found for slug: ${montura}`);
}

let selectedColor: Color = product.details[0].colors[0];

function changeColor(color: Color) {
  selectedColor = color;
  console.log(selectedColor);
}
---

<Layout title={product.name} description="">
  {
    product.details.map((detail) => (
      <section
      class="text-black mt-[60px] lg:mt-[64px] flex items-center justify-center gap-8"
      >
        <article class="lg:w-1/2">
          <h1 class="text-5xl">{product.name}</h1>
          <p class="text-lg">{detail.detailed_description}</p>
        </article>
        <figure class="lg:w-1/2 flex justify-center items-center">
          <img class="w-full" src={product.card_image} alt={product.name} />
        </figure>
      </section>
      
      <section class="flex flex-col gap-[20px]">
        <article class="flex flex-col gap-5 lg:w-1/2">
          {detail.intro_text_1 && <p>{detail.intro_text_1}</p>}
          {detail.intro_text_2 && <p>{detail.intro_text_2}</p>}
          {detail.intro_text_3 && <p>{detail.intro_text_3}</p>}
        </article>
        <article class="flex flex-col gap-5">
          <h2 class="text-xl">Selecciona un color:</h2>
          <div class="flex lg:flex-row gap-4">
            <div>
              <img src={selectedColor.image} alt={selectedColor.name} />
            </div>
            <div class="flex gap-2">
              {
                detail.colors.map((color: Color) => (
                  <div class="available-color" data-color={JSON.stringify(color)}>
                    <img 
                      class="w-16 hover:scale-105" 
                      src={color.image} 
                      alt={color.name} 
                    />
                  </div>
                ))
              }
            </div>
          </div>
        </article>
      </section>
    ))
  }
</Layout>